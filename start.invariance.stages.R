# This script works through invaraince testing of both versions of AtL and Cog
# CONFIGURAL
# AtL (PLBS) + Cog
long.invar5 <- '
atl1 =~ R1ATTUDE + R1PRSIST + R1MOTIVE
atl2 =~ R2ATTUDE + R2PRSIST + R2MOTIVE
atl3 =~ R3ATTUDE + R3PRSIST + R3MOTIVE
atl4 =~ KR4ATUDE + KR4PRSST + KR4MOTIV

cog1 =~ A1PPVT4W + A1WJAPW + A1WJLWW
cog2 =~ A2PPVT4W + A2WJAPW + A2WJLWW
cog3 =~ A3PPVT4W + A3WJAPW + A3WJLWW
cog4 =~ A4PPVT4W + A4WJAPW + A4WJLWW

R1ATTUDE ~~ R1ATTUDE
R1PRSIST ~~ R1PRSIST
R1MOTIVE ~~ R1MOTIVE
R2ATTUDE ~~ R2ATTUDE
R2PRSIST ~~ R2PRSIST
R2MOTIVE ~~ R2MOTIVE
R3ATTUDE ~~ R3ATTUDE
R3PRSIST ~~ R3PRSIST
R3MOTIVE ~~ R3MOTIVE
KR4ATUDE ~~ KR4ATUDE
KR4PRSST ~~ KR4PRSST
KR4MOTIV ~~ KR4MOTIV

R1ATTUDE ~~ R2ATTUDE
R1ATTUDE ~~ R3ATTUDE
R1ATTUDE ~~ KR4ATUDE
R2ATTUDE ~~ R3ATTUDE
R2ATTUDE ~~ KR4ATUDE
R3ATTUDE ~~ KR4ATUDE

R1PRSIST ~~ R2PRSIST
R1PRSIST ~~ R3PRSIST
R1PRSIST ~~ KR4PRSST
R2PRSIST ~~ R3PRSIST
R2PRSIST ~~ KR4PRSST
R3PRSIST ~~ KR4PRSST

R1MOTIVE ~~ R2MOTIVE
R1MOTIVE ~~ R3MOTIVE
R1MOTIVE ~~ KR4MOTIV
R2MOTIVE ~~ R3MOTIVE
R2MOTIVE ~~ KR4MOTIV
R3MOTIVE ~~ KR4MOTIV

A1PPVT4W ~~ A1PPVT4W
A1WJAPW ~~ A1WJAPW
A1WJLWW ~~ A1WJLWW
A2PPVT4W ~~ A2PPVT4W
A2WJAPW ~~ A2WJAPW
A2WJLWW ~~ A2WJLWW
A3PPVT4W ~~ A3PPVT4W
A3WJAPW ~~ A3WJAPW
A3WJLWW ~~ A3WJLWW
A4PPVT4W ~~ A4PPVT4W
A4WJAPW ~~ A4WJAPW
A4WJLWW ~~ A4WJLWW

A1PPVT4W ~~ A2PPVT4W
A1PPVT4W ~~ A3PPVT4W
A1PPVT4W ~~ A4PPVT4W
A2PPVT4W ~~ A3PPVT4W
A2PPVT4W ~~ A4PPVT4W
A3PPVT4W ~~ A4PPVT4W

A1WJAPW ~~ A2WJAPW
A1WJAPW ~~ A3WJAPW
A1WJAPW ~~ A4WJAPW
A2WJAPW ~~ A3WJAPW
A2WJAPW ~~ A4WJAPW
A3WJAPW ~~ A4WJAPW

A1WJLWW ~~ A2WJLWW
A1WJLWW ~~ A3WJLWW
A1WJLWW ~~ A4WJLWW
A2WJLWW ~~ A3WJLWW
A2WJLWW ~~ A4WJLWW
A3WJLWW ~~ A4WJLWW
'
fit5 <- cfa(long.invar5, missing = "FIML", estimator = "MLR", data = FACES2006.subset, std.lv=TRUE) 
summary(fit5, fit.measures = TRUE, rsquare = TRUE, standardized = TRUE)
inspect(fit5, "cov.lv") 
inspect(fit5, "cov.ov") # always good to look for negatives
#library(semTools)
#invariance5 <- measurementInvariance(long.invar5, data = FACES2006.subset)
#------------------------------------------
# WEAK
# AtL (PLBS) + Cog
long.invar5.b <- '
atl1 =~ a1*R1ATTUDE + a2*R1PRSIST + a3*R1MOTIVE
atl2 =~ a1*R2ATTUDE + a2*R2PRSIST + a3*R2MOTIVE
atl3 =~ a1*R3ATTUDE + a2*R3PRSIST + a3*R3MOTIVE
atl4 =~ a1*KR4ATUDE + a2*KR4PRSST + a3*KR4MOTIV

cog1 =~ c1*A1PPVT4W + c2*A1WJAPW + c3*A1WJLWW
cog2 =~ c1*A2PPVT4W + c2*A2WJAPW + c3*A2WJLWW
cog3 =~ c1*A3PPVT4W + c2*A3WJAPW + c3*A3WJLWW
cog4 =~ c1*A4PPVT4W + c2*A4WJAPW + c3*A4WJLWW

R1ATTUDE ~~ R1ATTUDE
R1PRSIST ~~ R1PRSIST
R1MOTIVE ~~ R1MOTIVE
R2ATTUDE ~~ R2ATTUDE
R2PRSIST ~~ R2PRSIST
R2MOTIVE ~~ R2MOTIVE
R3ATTUDE ~~ R3ATTUDE
R3PRSIST ~~ R3PRSIST
R3MOTIVE ~~ R3MOTIVE
KR4ATUDE ~~ KR4ATUDE
KR4PRSST ~~ KR4PRSST
KR4MOTIV ~~ KR4MOTIV

R1ATTUDE ~~ R2ATTUDE
R1ATTUDE ~~ R3ATTUDE
R1ATTUDE ~~ KR4ATUDE
R2ATTUDE ~~ R3ATTUDE
R2ATTUDE ~~ KR4ATUDE
R3ATTUDE ~~ KR4ATUDE

R1PRSIST ~~ R2PRSIST
R1PRSIST ~~ R3PRSIST
R1PRSIST ~~ KR4PRSST
R2PRSIST ~~ R3PRSIST
R2PRSIST ~~ KR4PRSST
R3PRSIST ~~ KR4PRSST

R1MOTIVE ~~ R2MOTIVE
R1MOTIVE ~~ R3MOTIVE
R1MOTIVE ~~ KR4MOTIV
R2MOTIVE ~~ R3MOTIVE
R2MOTIVE ~~ KR4MOTIV
R3MOTIVE ~~ KR4MOTIV

A1PPVT4W ~~ A1PPVT4W
A1WJAPW ~~ A1WJAPW
A1WJLWW ~~ A1WJLWW
A2PPVT4W ~~ A2PPVT4W
A2WJAPW ~~ A2WJAPW
A2WJLWW ~~ A2WJLWW
A3PPVT4W ~~ A3PPVT4W
A3WJAPW ~~ A3WJAPW
A3WJLWW ~~ A3WJLWW
A4PPVT4W ~~ A4PPVT4W
A4WJAPW ~~ A4WJAPW
A4WJLWW ~~ A4WJLWW

A1PPVT4W ~~ A2PPVT4W
A1PPVT4W ~~ A3PPVT4W
A1PPVT4W ~~ A4PPVT4W
A2PPVT4W ~~ A3PPVT4W
A2PPVT4W ~~ A4PPVT4W
A3PPVT4W ~~ A4PPVT4W

A1WJAPW ~~ A2WJAPW
A1WJAPW ~~ A3WJAPW
A1WJAPW ~~ A4WJAPW
A2WJAPW ~~ A3WJAPW
A2WJAPW ~~ A4WJAPW
A3WJAPW ~~ A4WJAPW

A1WJLWW ~~ A2WJLWW
A1WJLWW ~~ A3WJLWW
A1WJLWW ~~ A4WJLWW
A2WJLWW ~~ A3WJLWW
A2WJLWW ~~ A4WJLWW
A3WJLWW ~~ A4WJLWW
'
fit5.b <- cfa(long.invar5.b, missing = "FIML", estimator = "MLR", data = FACES2006.subset, std.lv=TRUE) 
summary(fit5.b, fit.measures = TRUE, rsquare = TRUE, standardized = TRUE)
inspect(fit5.b, "cov.lv") 
inspect(fit5.b, "cov.ov") # always good to look for negatives
#library(semTools)
#invariance5 <- measurementInvariance(long.invar5, data = FACES2006.subset)
#-----------------------------------------
# STRONG
# AtL (PLBS) + Cog
long.invar5.c <- '
atl1 =~ a1*R1ATTUDE + a2*R1PRSIST + a3*R1MOTIVE
atl2 =~ a1*R2ATTUDE + a2*R2PRSIST + a3*R2MOTIVE
atl3 =~ a1*R3ATTUDE + a2*R3PRSIST + a3*R3MOTIVE
atl4 =~ a1*KR4ATUDE + a2*KR4PRSST + a3*KR4MOTIV

cog1 =~ c1*A1PPVT4W + c2*A1WJAPW + c3*A1WJLWW
cog2 =~ c1*A2PPVT4W + c2*A2WJAPW + c3*A2WJLWW
cog3 =~ c1*A3PPVT4W + c2*A3WJAPW + c3*A3WJLWW
cog4 =~ c1*A4PPVT4W + c2*A4WJAPW + c3*A4WJLWW

R1ATTUDE ~~ R1ATTUDE
R1PRSIST ~~ R1PRSIST
R1MOTIVE ~~ R1MOTIVE
R2ATTUDE ~~ R2ATTUDE
R2PRSIST ~~ R2PRSIST
R2MOTIVE ~~ R2MOTIVE
R3ATTUDE ~~ R3ATTUDE
R3PRSIST ~~ R3PRSIST
R3MOTIVE ~~ R3MOTIVE
KR4ATUDE ~~ KR4ATUDE
KR4PRSST ~~ KR4PRSST
KR4MOTIV ~~ KR4MOTIV

R1ATTUDE ~~ R2ATTUDE
R1ATTUDE ~~ R3ATTUDE
R1ATTUDE ~~ KR4ATUDE
R2ATTUDE ~~ R3ATTUDE
R2ATTUDE ~~ KR4ATUDE
R3ATTUDE ~~ KR4ATUDE

R1PRSIST ~~ R2PRSIST
R1PRSIST ~~ R3PRSIST
R1PRSIST ~~ KR4PRSST
R2PRSIST ~~ R3PRSIST
R2PRSIST ~~ KR4PRSST
R3PRSIST ~~ KR4PRSST

R1MOTIVE ~~ R2MOTIVE
R1MOTIVE ~~ R3MOTIVE
R1MOTIVE ~~ KR4MOTIV
R2MOTIVE ~~ R3MOTIVE
R2MOTIVE ~~ KR4MOTIV
R3MOTIVE ~~ KR4MOTIV

A1PPVT4W ~~ A1PPVT4W
A1WJAPW ~~ A1WJAPW
A1WJLWW ~~ A1WJLWW
A2PPVT4W ~~ A2PPVT4W
A2WJAPW ~~ A2WJAPW
A2WJLWW ~~ A2WJLWW
A3PPVT4W ~~ A3PPVT4W
A3WJAPW ~~ A3WJAPW
A3WJLWW ~~ A3WJLWW
A4PPVT4W ~~ A4PPVT4W
A4WJAPW ~~ A4WJAPW
A4WJLWW ~~ A4WJLWW

A1PPVT4W ~~ A2PPVT4W
A1PPVT4W ~~ A3PPVT4W
A1PPVT4W ~~ A4PPVT4W
A2PPVT4W ~~ A3PPVT4W
A2PPVT4W ~~ A4PPVT4W
A3PPVT4W ~~ A4PPVT4W

A1WJAPW ~~ A2WJAPW
A1WJAPW ~~ A3WJAPW
A1WJAPW ~~ A4WJAPW
A2WJAPW ~~ A3WJAPW
A2WJAPW ~~ A4WJAPW
A3WJAPW ~~ A4WJAPW

A1WJLWW ~~ A2WJLWW
A1WJLWW ~~ A3WJLWW
A1WJLWW ~~ A4WJLWW
A2WJLWW ~~ A3WJLWW
A2WJLWW ~~ A4WJLWW
A3WJLWW ~~ A4WJLWW

R1ATTUDE ~ m1*1
R2ATTUDE ~ m1*1
R3ATTUDE ~ m1*1
KR4ATUDE ~ m1*1
R1PRSIST ~ m2*1
R2PRSIST ~ m2*1
R3PRSIST ~ m2*1
KR4PRSST ~ m2*1
R1MOTIVE ~ m3*1
R2MOTIVE ~ m3*1
R3MOTIVE ~ m3*1
KR4MOTIV ~ m3*1

A1PPVT4W ~ m4*1
A2PPVT4W ~ m4*1
A3PPVT4W ~ m4*1
A4PPVT4W ~ m4*1
A1WJAPW ~ m5*1
A2WJAPW ~ m5*1
A3WJAPW ~ m5*1
A4WJAPW ~ m5*1
A1WJLWW ~ m6*1
A2WJLWW ~ m6*1
A3WJLWW ~ m6*1
A4WJLWW ~ m6*1
'
fit5.c <- cfa(long.invar5.c, missing = "FIML", estimator = "MLR", data = FACES2006.subset, std.lv=TRUE) 
summary(fit5.c, fit.measures = TRUE, rsquare = TRUE, standardized = TRUE)
inspect(fit5.c, "cov.lv") 
inspect(fit5.c, "cov.ov") # always good to look for negatives
#library(semTools)
#invariance5 <- measurementInvariance(long.invar5, data = FACES2006.subset)
mi5.c <- modindices(fit5.c)
mi5.c[mi5.c$op == "=~",]

